(function(f){function k(c){this.init(c)}k.prototype={value:0,size:100,startAngle:-Math.PI,thickness:"auto",fill:{gradient:["#3aeabb","#fdd250"]},emptyFill:"rgba(0, 0, 0, .1)",animation:{duration:1200,easing:"circleProgressEasing"},animationStartValue:0,reverse:!1,lineCap:"butt",constructor:k,el:null,canvas:null,ctx:null,radius:0,arcFill:null,lastFrameValue:0,init:function(c){f.extend(this,c);this.radius=this.size/2;this.initWidget();this.initFill();this.draw()},initWidget:function(){var c=this.canvas=
this.canvas||f("<canvas>").prependTo(this.el)[0];c.width=this.size;c.height=this.size;this.ctx=c.getContext("2d")},initFill:function(){function c(){var b=f("<canvas>")[0];b.width=a.size;b.height=a.size;b.getContext("2d").drawImage(l,0,0,e,e);a.arcFill=a.ctx.createPattern(b,"no-repeat");a.drawFrame(a.lastFrameValue)}var a=this,b=this.fill,d=this.ctx,e=this.size;if(!b)throw Error("The fill is not specified!");b.color&&(this.arcFill=b.color);if(b.gradient){var g=b.gradient;if(1==g.length)this.arcFill=
g[0];else if(1<g.length){for(var h=b.gradientAngle||0,d=d.createLinearGradient.apply(d,b.gradientDirection||[e/2*(1-Math.cos(h)),e/2*(1+Math.sin(h)),e/2*(1+Math.cos(h)),e/2*(1-Math.sin(h))]),h=0;h<g.length;h++){var m=g[h],k=h/(g.length-1);f.isArray(m)&&(k=m[1],m=m[0]);d.addColorStop(k,m)}this.arcFill=d}}if(b.image){var l;b.image instanceof Image?l=b.image:(l=new Image,l.src=b.image);l.complete?c():l.onload=c}},draw:function(){this.animation?this.drawAnimated(this.value):this.drawFrame(this.value)},
drawFrame:function(c){this.lastFrameValue=c;this.ctx.clearRect(0,0,this.size,this.size);this.drawEmptyArc(c);this.drawArc(c)},drawArc:function(c){var a=this.ctx,b=this.radius,d=this.getThickness(),e=this.startAngle;a.save();a.beginPath();this.reverse?a.arc(b,b,b-d/2,e-2*Math.PI*c,e):a.arc(b,b,b-d/2,e,e+2*Math.PI*c);a.lineWidth=d;a.lineCap=this.lineCap;a.strokeStyle=this.arcFill;a.stroke();a.restore()},drawEmptyArc:function(c){var a=this.ctx,b=this.radius,d=this.getThickness(),e=this.startAngle;1>
c&&(a.save(),a.beginPath(),0>=c?a.arc(b,b,b-d/2,0,2*Math.PI):this.reverse?a.arc(b,b,b-d/2,e,e-2*Math.PI*c):a.arc(b,b,b-d/2,e+2*Math.PI*c,e),a.lineWidth=d,a.strokeStyle=this.emptyFill,a.stroke(),a.restore())},drawAnimated:function(c){var a=this,b=this.el,d=f(this.canvas);d.stop(!0,!1);b.trigger("circle-animation-start");d.css({animationProgress:0}).animate({animationProgress:1},f.extend({},this.animation,{step:function(e){var d=a.animationStartValue*(1-e)+c*e;a.drawFrame(d);b.trigger("circle-animation-progress",
[e,d])}})).promise().always(function(){b.trigger("circle-animation-end")})},getThickness:function(){return f.isNumeric(this.thickness)?this.thickness:this.size/14},getValue:function(){return this.value},setValue:function(c){this.animation&&(this.animationStartValue=this.lastFrameValue);this.value=c;this.draw()}};f.circleProgress={defaults:k.prototype};f.easing.circleProgressEasing=function(c,a,b,d,e){return 1>(a/=e/2)?d/2*a*a*a+b:d/2*((a-=2)*a*a+2)+b};f.fn.circleProgress=function(c,a){var b=this.data("circle-progress");
if("widget"==c){if(!b)throw Error('Calling "widget" method on not initialized instance is forbidden');return b.canvas}if("value"==c){if(!b)throw Error('Calling "value" method on not initialized instance is forbidden');return"undefined"==typeof a?b.getValue():this.each(function(){f(this).data("circle-progress").setValue(a)})}return this.each(function(){var b=f(this),a=b.data("circle-progress"),g=f.isPlainObject(c)?c:{};a?a.init(g):(a=f.extend({},b.data()),"string"==typeof a.fill&&(a.fill=JSON.parse(a.fill)),
"string"==typeof a.animation&&(a.animation=JSON.parse(a.animation)),g=f.extend(a,g),g.el=b,a=new k(g),b.data("circle-progress",a))})}})(jQuery);
